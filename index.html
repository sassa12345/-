<!DOCTYPE html>
<html>
<head>
<title>ZIP MP3 Player</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  body {
    font-family: sans-serif;
  }
  #player {
    width: 300px;
    padding: 20px;
    border: 1px solid #ccc;
  }
  button {
    margin: 5px;
  }
</style>
</head>
<body>
<div id="player">
  <input type="file" id="zipFileInput" accept=".zip">
  <audio id="audio" controls></audio>
  <div id="currentTrackName"></div>
</div>

<script>
  const zipFileInput = document.getElementById('zipFileInput');
  const audio = document.getElementById('audio');
  const currentTrackName = document.getElementById('currentTrackName');
  let zip;
  let mp3Files = [];

  zipFileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];

    JSZip.loadAsync(file).then(function(loadedZip) {
      zip = loadedZip;
      mp3Files = [];

      zip.forEach(function (relativePath, zipEntry) {
        if (zipEntry.name.endsWith('.mp3')) {
          mp3Files.push(zipEntry);
        }
      });

      if (mp3Files.length > 0) {
        playRandomTrack();
      } else {
        alert('ZIPファイルにMP3ファイルが含まれていません。');
      }
    });
  });

  function playRandomTrack() {
    if (mp3Files.length === 0) return;

    const randomIndex = Math.floor(Math.random() * mp3Files.length);
    const randomTrack = mp3Files[randomIndex];

    randomTrack.async("blob").then(function(blob) {
      const audioUrl = URL.createObjectURL(blob);
      audio.src = audioUrl;
      audio.play();
      currentTrackName.textContent = randomTrack.name;
    });
  }

  audio.addEventListener('ended', () => {
    playRandomTrack();
  });
</script>

</body>
</html>
